<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Insa PDF Tool</title>
    <link rel="stylesheet" href="./css/style.css" />
  </head>
  <body>
    <div class="titlebar">
      <div class="menu-container">
        <button class="menu-button" id="menu-file">파일</button>
        <button class="menu-button" id="menu-edit">편집</button>
        <button class="menu-button" id="menu-setting">설정</button>
        <button class="menu-button" id="menu-help">도움말</button>
      </div>
      <div class="window-controls">
        <button id="minimize-btn">
          <img id="minimize-img" src="../img/ui-minimize.png" />
        </button>
        <button id="maximize-btn">
          <img id="maximize-img" src="../img/ui-maximize.png" />
        </button>
        <button id="close-btn">
          <img id="close-img" src="../img/ui-close.png" />
        </button>
      </div>
    </div>

    <div class="modal-wrapper hide" id="wrapper-file">
      <ul class="submenu-container" id="submenu-file">
        <input type="file" class="hide" id="open-pdf" accept=".pdf" multiple />
        <label id="open-pdf-label" for="open-pdf">
          <li id="open-pdf-btn">
            <div class="menu-name">열기</div>
            <div class="short-cut">Ctrl+O</div>
          </li>
        </label>
        <li id="save-pdf-btn" class="disabled">
          <div class="menu-name">다른이름으로 저장</div>
          <div class="short-cut">Ctrl+S</div>
        </li>
      </ul>
    </div>

    <div class="modal-wrapper hide" id="wrapper-edit">
      <ul class="submenu-container" id="submenu-edit">
        <li id="undo-btn" class="disabled">
          <div class="menu-name">되돌리기</div>
          <div class="short-cut">Ctrl+Z</div>
        </li>
        <li id="redo-btn" class="disabled">
          <div class="menu-name">다시실행</div>
          <div class="short-cut">Ctrl+Y</div>
        </li>
        <div class="divide-line"></div>
        <li id="ocr-btn" class="disabled">
          <div class="menu-name">개인정보 전체탐색</div>
          <div class="short-cut">Ctrl+F</div>
        </li>
        <li id="reset-all-btn" class="disabled">
          <div class="menu-name">전체 마스킹 초기화</div>
          <div class="short-cut">Ctrl+R</div>
        </li>
        <li id="extract-select-btn" class="disabled">
          <div class="menu-name">특정페이지 추출</div>
          <div class="short-cut">Ctrl+E</div>
        </li>
      </ul>
    </div>

    <div class="modal-wrapper hide" id="wrapper-setting">
      <ul class="submenu-container" id="submenu-setting">
        <li id="regex-btn">
          <div class="menu-name">키워드 관리</div>
        </li>
        <li id="regex-clear-btn">
          <div class="menu-name">키워드 초기화</div>
        </li>
        <li id="always-ocr">
          <div class="menu-name">
            <label for="always-ocr-check">항상 OCR</label>
            <input type="checkbox" id="always-ocr-check" />
          </div>
        </li>
      </ul>
    </div>

    <main>
      <div id="pdf-viewer-controls">
        <div id="function-controls">
          <div id="ocr-this-page" class="disabled">
            <img class="func-img" src="../img/ui-search.png" />
            <span class="tooltip">키워드탐색</span>
          </div>
          <div id="mask-box-btn" class="isused disabled">
            <img class="func-img" src="../img/ui-masking.png" />
            <span class="tooltip">마스킹</span>
          </div>
          <div id="mask-box-option">
            <input id="isblur" type="checkbox" />
            <label for="isblur">블러</label>
            <input id="pick-mask-color" type="color" value="#000000" />
            <label for="pick-mask-color">마스크 색</label>
          </div>
          <div id="mask-erase-btn" class="disabled">
            <img class="func-img" src="../img/ui-eraser.png" />
            <span class="tooltip">지우개</span>
          </div>
          <div id="reset-btn" class="disabled">
            <img class="func-img" src="../img/ui-reset.png" />
            <span class="tooltip">초기화</span>
          </div>
          <div id="extract-btn" class="disabled">
            <img class="func-img" src="../img/ui-extract.png" />
            <span class="tooltip">추출</span>
          </div>
          <div id="undo-btn-icon" class="disabled">
            <img class="func-img" src="../img/ui-undo.png" />
            <span class="tooltip">되돌리기</span>
          </div>
          <div id="redo-btn-icon" class="disabled">
            <img class="func-img" src="../img/ui-redo.png" />
            <span class="tooltip">다시실행</span>
          </div>
        </div>

        <div id="page-controls">
          <span id="page-info">
            <input class="disabled" id="current-page" type="number" /> /
            <span id="total-page"></span>
          </span>
        </div>
      </div>

      <!-- PDF 파일 뷰어 -->
      <div id="pdf-viewer-container">
        <canvas id="pdf-canvas"></canvas>
        <canvas id="masking-canvas"></canvas>
        <div id="scroll-bar">
          <button id="prev-page-btn" disabled>
            <img src="../img/ui-uparrow.png" />
          </button>
          <div id="scroll-thumb-container">
            <div id="scroll-thumb" class="hide"></div>
          </div>
          <button id="next-page-btn" disabled>
            <img src="../img/ui-downarrow.png" />
          </button>
        </div>
      </div>
    </main>

    <footer>
      <div id="messagebox"></div>
    </footer>

    <div id="working-modal" class="hide">
      <div id="working-modal-content">
        <div id="brightness-container">
          <img id="brightness" />
        </div>
        <div class="progress-bar-container">
          <div id="ocr-progress-bar" class="progress-bar"></div>
        </div>
        <div id="progress-text-container">
          <p id="ocr-progress-text">OCR 준비 중...</p>
        </div>
      </div>
    </div>

    <div id="extract-modal" class="hide">
      <div id="extract-modal-content">
        <div id="extract-modal-title">페이지 추출</div>
        <div id="extract-modal-sub">
          1,2,4-7처럼 페이지를 지정해 추출합니다.
        </div>
        <input
          type="text"
          name="extract-pages"
          id="extract-pages"
          placeholder="추출할 페이지를 선택해주세요"
        />
        <div id="extract-modal-buttons">
          <button id="extract-ok">확인</button>
          <button id="extract-cancel">닫기</button>
        </div>
      </div>
    </div>

    <div id="regex-modal" class="hide">
      <div id="regex-modal-content">
        <ul id="regex-key-list"></ul>
        <div id="regex-input">
          <div>명칭</div>
          <input
            type="text"
            name="regex-key"
            id="regex-key"
            placeholder="명칭"
          />
          <div>탐색할 문자</div>
          <input
            type="text"
            name="regex-value"
            id="regex-value"
            placeholder="정규식"
          />
          <div id="regex-modal-buttons">
            <button id="regex-ok">반영</button>
            <button id="regex-cancel">닫기</button>
          </div>
        </div>
      </div>
    </div>

    <div id="help-modal" class="hide">
      <div id="help-modal-content">
        <div id="help-modal-close">
          <img class="func-img" src="../img/ui-close.png" />
        </div>
        <div id="help-modal-text">
          <div class="help-modal-paragraph">
            <div class="help-modal-title">■ PDF Tool</div>
            <div class="help-text">
              pdf파일의 개인정보 또는 특정 단어 등을 수동으로 가리거나 탐색하여
              자동으로 지울 수 있는 프로그램입니다.
            </div>
            <div class="help-text">
              예를 들어 다음과 같은 경우 주민등록번호를 탐색하여 마스킹합니다.
            </div>
            <div class="help-text"></div>
            <div class="help-text">
              <img src="../img/help-before.png" class="help-img" />
              <div class="blank"></div>
              ▶
              <div class="blank"></div>
              <img class="help-modal-img" src="../img/ui-search.png" />
              키워드탐색
              <div class="blank"></div>
              ▶
              <div class="blank"></div>
              <img src="../img/help-after.png" class="help-img" />
            </div>
            <div class="help-text"></div>
            <div class="help-text">
              저장 전까지는 반투명하게 처리하여 마스킹 전의 내용을 알 수
              있습니다.
            </div>
            <div class="help-text">
              그 외에 부가적으로 파일 병합 및 페이지 추출 기능이 있습니다.
            </div>
          </div>
          <div class="help-modal-paragraph">
            <div class="help-modal-title">■ 주요 기능</div>
            <div class="help-modal-title">1. 현재페이지 제어</div>
            <div class="help-text">
              PDF 파일 내용이 표시되는 뷰어 위의 버튼들(
              <img class="help-modal-img" src="../img/ui-search.png" />
              <img class="help-modal-img" src="../img/ui-masking.png" />
              <img class="help-modal-img" src="../img/ui-eraser.png" />
              <img class="help-modal-img" src="../img/ui-reset.png" />
              <img class="help-modal-img" src="../img/ui-extract.png" />
              )은 현재 보고 있는 페이지에 대한 작업을 수행합니다.
            </div>
            <div class="help-text"></div>
            <div class="help-text">
              <img class="help-modal-img" src="../img/ui-search.png" />
              <div class="blank"></div>
              (키워드탐색) : 현재 페이지 내 키워드를 탐색합니다.
            </div>
            <div class="help-text">
              - 기본적으로 주민등록번호, 전화번호가 세팅되어 있으며 추가하려면
              상단 [설정]-[키워드 관리]에서 추가하면 됩니다.
            </div>
            <div class="help-text">
              - 미리 세팅된 주민등록번호나 전화번호 키워드를 지운 경우 아래
              키워드를 추가하면 됩니다.
            </div>
            <div class="help-text">
              ① 명칭 : 주민등록번호 / 탐색할 문자 :
              \d{2}([0]\d|[1][0-2])([0][1-9]|[1-2]\d|[3][0-1])[-]*[1-4]\d{6}
            </div>
            <div class="help-text">
              ② 명칭 : 전화번호 / 탐색할 문자 : 0\d{2}-?\d{3,4}-?d{4}
            </div>
            <div class="help-text"></div>
            <div class="help-text">
              <img class="help-modal-img" src="../img/ui-masking.png" />
              <div class="blank"></div>
              (마스킹) 선택 후 PDF에 드래그해서 마스크를 추가할 수 있습니다.
            </div>
            <div class="help-text">
              - 블러처리할 지 단색으로 채울 지 체크할 수 있습니다.(색깔
              선택가능)
            </div>
            <div class="help-text">
              - 블러처리하면 편집화면에서는 파란 박스로 경계선만 표시되고 저장
              후에 블러처리됩니다.
            </div>
            <div class="help-text">
              <img src="../img/help-blur.png" class="help-img" />
              <div class="blank"></div>
              ▶
              <div class="blank"></div>
              저장
              <div class="blank"></div>
              ▶
              <div class="blank"></div>
              <img src="../img/help-blurafter.png" class="help-img" />
            </div>
            <div class="help-text">
              <img class="help-modal-img" src="../img/ui-eraser.png" />
              <div class="blank"></div>
              (지우개) 선택 후 드래그해서 범위 내의 마스크를 지울 수 있습니다.
            </div>
            <div class="help-text">
              <img class="help-modal-img" src="../img/ui-reset.png" />
              <div class="blank"></div>
              (초기화) 현재 페이지의 마스크들을 초기화합니다.
            </div>
            <div class="help-text">
              <img class="help-modal-img" src="../img/ui-extract.png" />
              <div class="blank"></div>
              (추출) 현재 페이지를 별도의 파일로 추출합니다.
            </div>
            <div class="help-text">
              <img class="help-modal-img" src="../img/ui-undo.png" />
              <img class="help-modal-img" src="../img/ui-redo.png" />
              <div class="blank"></div>
              되돌리기, 다시실행으로 작업한 내용을 취소하거나 다시 실행할 수
              있습니다.
            </div>
          </div>
          <div class="help-modal-paragraph">
            <div class="help-modal-title">2. 상단 메뉴</div>
            <div class="help-text">
              [파일], [편집] 등 상단의 메뉴들은 파일 병합, 전체 마스킹, 전체
              마스크 삭제 등 파일 전체 페이지에 연관된 기능들입니다.
            </div>
            <div class="help-text"></div>
            <div class="help-text">
              ① [파일] 열기를 통해 여러 PDF 파일을 선택해 병합을 수행할 수
              있습니다.
            </div>
            <div class="help-text">
              ② [편집] 개인정보 전체탐색은 전체 페이지를 대상으로 키워드를
              탐색합니다.
            </div>
            <div class="help-text">
              ③ [편집] 특정페이지 추출은 입력한 페이지들을 추출합니다.
            </div>
            <div class="help-text">
              ④ [설정] 키워드 관리로 탐색할 키워드들을 관리할 수 있습니다.
            </div>
            <div class="help-text">
              - 키워드는 명칭과 탐색할 문자로 구성되어 있으며 명칭은 중복될 수
              없습니다.
            </div>
            <div class="help-text">
              <img src="../img/help-keyword.png" class="help-img" />
              <div class="blank"></div>
              ▶
              <div class="blank"></div>
              탐색
              <div class="blank"></div>
              ▶
              <div class="blank"></div>
              <img src="../img/help-keywordafter.png" class="help-img" />
            </div>
            <div class="help-text">
              ⑤ [설정] OCR(이미지 문자 인식) 기능을 항상 먼저 사용할 지 설정할
              수 있습니다.
            </div>
            <div class="help-text">
              - OCR 기능은 시간이 오래걸리는 관계로 PDF 내에 기본적으로 텍스트
              정보가 없는 경우 실행하게 되어있습니다.
            </div>
            <div class="help-text">
              - 무료 OCR 기능을 사용했기 때문에 오탐지, 미탐지하는 경우가 다수
              있습니다.
            </div>
          </div>
          <div class="help-modal-paragraph">
            <div class="help-modal-title">3. 주의사항</div>
            <div class="help-text">
              ① 무료 OCR 기능을 사용했기 때문에 키워드 탐색 기능을 너무 맹신하면
              안됩니다.
            </div>
            <div class="help-text">
              - 항상 오탐지, 미탐지할 수 있음을 고려해야 합니다.
            </div>
            <div class="help-text">
              - 입력한 키워드 근처의 텍스트도 같이 마스킹처리될 수 있습니다.
              예를 들어 '질병'을 검색했는데 '질병휴직'을 마스킹할 수도 있습니다.
            </div>
            <div class="help-text">
              ② 결과물에서 찾기(Ctrl+F)등으로 개인정보를 탐색하는 것을 막기 위해
              저장하면 이미지로 변환되며 텍스트 정보 등이 누락됩니다.
            </div>
            <div class="help-text">
              ③ 글자 크기가 너무 크면 마스킹 범위가 어긋납니다.
            </div>
            <div class="help-text">
              ④ 내용편집 기능 등은 Canva같은 PDF 편집기를 사용할 수 있습니다.
            </div>
          </div>
        </div>
      </div>
    </div>

    <script async src="./opencv/opencv.js"></script>
    <script src="./ocr/worker.min.js"></script>
    <script src="./ocr/tesseract.min.js"></script>
    <script src="./pdfjs/pdf-lib.min.js"></script>
    <script src="./render.js" type="module"></script>
  </body>
</html>
